var wellClient=function(e){function n(e,n){var t=g.render(this.path,e);return g.sendRequest(t,this.method,n)}function t(){var e=this;e.realTimeLoggingOn=!1,e.recordLogs=!0,e.maxLines=2500,e.lineMaxChars=1500,e.logFilename="log4b.txt",e.lineBreak="\n\n",e.output="",this.getLog=function(){return e.recordLogs?e.output:"log recording is off"},this.downloadLog=function(){var n=e.formatTimestamp()+"-"+e.logFilename;if(window.navigator.msSaveBlob)try{var t=new Blob([e.output]);window.navigator.msSaveBlob(t,n)}catch(e){console.log(e)}else{var l="data:text/plain;charset=utf-8,",o=e.output;l+=encodeURIComponent(o);var i=document.createElement("a");i.href=l,i.target="_blank",i.download=n,document.body.appendChild(i),i.click(),i.remove()}},this.search=function(n){for(var t=e.output.split(e.lineBreak),l=new RegExp(n),o=[],i=0;i<t.length;i++)l.test(t[i])&&o.push("["+i+"]: "+t[i]);var a=o.join(e.lineBreak);return a||'Nothing found for "'+n+'".'},this.clear=function(){new Date;e.output="",e.realTimeLoggingOn&&console.log("[log4b.js] clear()")},this.log=function(n){e.recordLogs&&function(n){setTimeout(function(){e._log(n)},0)}(n)},this._log=function(n){"object"==typeof n&&(n=JSON.stringify(n)),"string"==typeof n&&(e.realTimeLoggingOn&&console.log(n),e.output+="["+e.formatTimestamp()+"]: ",e.output+=e.cutExceededChars(n)+e.lineBreak,e.output=e.trimLog(e.output,e.maxLines))},this.cutExceededChars=function(n){return n.length>e.lineMaxChars?n.substr(0,e.lineMaxChars):n},this.trimLog=function(n,t){var l=n.split(e.lineBreak);return l.length>t&&(l=l.slice(l.length-t)),l.join(e.lineBreak)},this.lines=function(){return e.output.split(e.lineBreak).length-1},this.formatTimestamp=function(){var e=new Date,n=e.getFullYear(),t=e.getDate();return n+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+t+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+"."+e.getMilliseconds()}}jQuery.support.cors=!0;var l=function(){};l.pt=l.prototype;var o={SDK:"163.53.88.183",cstaPort:"8088",eventPort:"8088",TPI:"163.53.88.183:5003/login",innerDeviceReg:/^8\d{3,5}|902138784800|902138834600/,debug:!0,useWsLog:!0,eventBasePath:"/mvc/stomp",cstaBasePath:"/api/csta",clickCallClass:"well-canBeCalled",timeout:1,maxReconnectTimes:5,currentReconnectTimes:0,isLogined:!1,heartbeatLength:12e4,heartbeatId:"",enableAlert:!1,autoAnswer:!0,useEventLog:!0},i={withoutCallId:"callMemory has not this callId form event, maybe call event sent for many times."},a={length:0},c={setAgentState:{desc:"setAgentState login and logout",path:"/agent/state",method:"post",status:{204:"success",401:"username or password is error",451:"not login your wellPhone, or just wait a moment",453:"error deviceId",454:"agent already logined",455:"device already logined",456:"device state",457:"unauthorized device",459:"the device you want to use is useing by other agent",460:"can not set agent state when you are calling",461:"online agent amount over max limit"},fire:n},heartbeat:{desc:"agnent heart beat",path:"/agent/heartbeat/{{agentId}}",method:"post",fire:n},makeCall:{desc:"call out",path:"/callControl/calls",method:"post",fire:n},answerCall:{desp:"answer call",path:"/callControl/calls/{{callId}}/connections/{{connectionId}}/answer",method:"post",fire:n},dropConnection:{desp:"hang up the call",path:"/callControl/calls/{{callId}}/connections/{{connectionId}}",method:"delete",fire:n},holdCall:{desp:"hold call",path:"/callControl/calls/{{callId}}/connections/{{connectionId}}/hold",method:"post",fire:n},retrieveCall:{desp:"retrieve a call",path:"/callControl/calls/{{callId}}/connections/{{connectionId}}/retrieve",method:"post",fire:n},singleStepTransfer:{desp:"single step transfer",path:"/callControl/calls/{{callId}}/connections/{{connectionId}}/singleStepTransfer",method:"post",fire:n},singleStepConference:{desp:"single step conference",path:"/callControl/calls/{{callId}}/connections/{{connectionId}}/singleStepConference",method:"post",fire:n},consult:{desp:"ask someome, hold current line",path:"/callControl/calls/{{callId}}/connections/{{connectionId}}/consult",method:"post",fire:n},conference:{desp:"talk to everybody",path:"/callControl/calls/{{callId}}/connections/{{connectionId}}/conference",method:"post",fire:n},cancelConsult:{desp:"cancel ask some",path:"/callControl/calls/{{callId}}/connections/{{connectionId}}/cancelConsult",method:"post",fire:n},transferCall:{desp:"ask someone, then transfer",path:"/callControl/calls/{{callId}}/connections/{{connectionId}}/transfer",method:"post",fire:n},setCallData:{desp:"set some data with callId",path:"/callControl/calls/{{callId}}/user-data",method:"post",fire:n},getCallData:{desp:"get all data of callId",path:"/callControl/calls/{{callId}}/user-data/{{key}}",method:"get",fire:n},spy:{desp:"listen the agent talk",path:"/callControl/calls/{{callId}}/spy?deviceId={{deviceId}}",method:"post",fire:n},releaseAllocatedAgent:{desp:"release allocated agent",path:"/api/csta/outbound/release/{{agentId}}",method:"post",fire:n}},r={number:"",password:"Aa123456",domain:"cmbyc.cc",ext:"",loginMode:"force",agentMode:"NotReady"},d={user:{},sessionId:""},s={},u={},g={getCallId:function(){if(1!==a.length)return"";for(var e in a)if(a.hasOwnProperty(e)&&void 0!==a[e].deviceCount)return e},logCallMemory:function(){try{g.log(">>> CALLMEMORY\n\r"+JSON.stringify(a)),g.log(">>> ENV\n\r"+JSON.stringify(d));var e=o.isLogined?"already login":"already logout";g.log(">>> STATUS: "+e)}catch(e){g.error(e)}},isOutCall:function(e,n){return this.isOutDeviceId(e)||this.isOutDeviceId(n)},isOutDeviceId:function(e){return e=e||"",e=e.split("@")[0],!o.innerDeviceReg.test(e)},render:function(e,n){for(var t=/{{([^}]+)?}}/g,l="";l=t.exec(e);)e=e.replace(l[0],n[l[1]]);return e},clearCache:function(){o.isLogined&&(d={user:{},sessionId:""},a={length:0},window.onunload=null,o.isLogined=!1,g.closeWebSocket(),clearInterval(o.heartbeatId))},log:function(e){o.debug&&window.console&&(console.info(">>>"+new Date),console.log(e)),l.pt.outputLog({type:"log",content:"object"==typeof e?JSON.stringify(e):e})},error:function(e){if(o.debug&&window.console)try{throw new Error(e)}catch(e){console.error(e)}l.pt.outputLog({type:"error",content:"object"==typeof e?JSON.stringify(e):e})},alert:function(e){o.debug&&window.console&&console.error(e),l.pt.outputLog({type:"alert",content:"object"==typeof e?JSON.stringify(e):e})},getErrorMsg:function(e,n){return c[e].status[n]||""},isPhoneNumber:function(e){return"string"==typeof e&&""!==e},sendRequest:function(n,t,l){var i=e.Deferred(),a="http://"+o.SDK+":"+o.cstaPort+o.cstaBasePath+n;return e.ajax({url:a,type:t||"get",headers:{sessionId:d.sessionId||""},data:JSON.stringify(l),dataType:"json",contentType:"application/json; charset=UTF-8",success:function(e){var n={url:a,method:t};g.debugout.log(n),i.resolve(e)},error:function(e){var n={url:a,method:t,payload:l,res:e};g.debugout.log(n),i.reject(e)}}),i.promise()},sendRequestSync:function(n,t,l){var i=e.Deferred(),a="http://"+o.SDK+":"+o.cstaPort+o.cstaBasePath+n;return e.ajax({url:a,type:t||"get",headers:{sessionId:d.sessionId||""},async:!1,data:JSON.stringify(l),dataType:"json",contentType:"application/json; charset=UTF-8",success:function(e){i.resolve(e)},error:function(e){i.reject(e)}}),i.promise()},TPILogin:function(n,t,l){var i=e.Deferred(),a="http://"+o.TPI,c="username="+n+"&password="+t+"&namespace="+l;return e.ajax({url:a,type:"post",data:c,dataType:"json",contentType:"application/x-www-form-urlencoded",success:function(e){var n={url:a,method:"post"};g.debugout.log(n),i.resolve(e)},error:function(e){var n={url:a,method:"post",payload:c,res:e};g.debugout.log(n),g.log(e.responseText),i.reject(e)}}),i.promise()},setAgentState:function(n){var t=e.Deferred(),l=c.setAgentState.method,o=c.setAgentState.path;return g.sendRequest(o,l,n).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()},setAgentStateSync:function(n){var t=e.Deferred(),l=c.setAgentState.method,o=c.setAgentState.path;return g.sendRequestSync(o,l,n).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()},login:function(n){var t=e.Deferred(),o={loginId:d.loginId,device:d.deviceId,password:d.user.password,agentMode:d.user.agentMode,func:"Login"};return g.setAgentState(o).done(function(e){g.initSoftPhone(),t.resolve(e)}).fail(function(e){if(n=n||"ask","454"==e.status)if("stop"===n)g.closeWebSocket(),t.reject(e);else if("ask"===n){var o=confirm("分机已经在别的地方登录，或者上次分机忘记登出，是否强制登录");o?l.pt.logout(!1).done(function(e){g.login().done(function(e){t.resolve()})}):(g.closeWebSocket(),t.reject(e))}else"force"===n&&l.pt.logout(!1).done(function(e){g.login().done(function(e){t.resolve()})});else if("455"==e.status){JSON.parse(data.responseText).agentMode;g.closeWebSocket(),t.reject(e)}else{var i=g.getErrorMsg("setAgentState",e.status);g.log(i),g.closeWebSocket(),t.reject(e)}}),t.promise()},initWebSocket:function(){var e="http://"+o.SDK+":"+o.eventPort+o.eventBasePath,n=new SockJS(e);u=Stomp.over(n),o.useWsLog||(u.debug=null),u.connect({},function(e){o.currentReconnectTimes=0;var n="/topic/csta/agent/"+d.loginId;u.subscribe(n,function(e){var n=JSON.parse(e.body);o.useEventLog&&g.debugout.log(e.body),v.deliverEvent(n)})},function(e){if(g.log(e),g.error(new Date+"websocket disconnect"),o.currentReconnectTimes<o.maxReconnectTimes)o.currentReconnectTimes++,g.reconnectWs();else{var n={eventName:"wsDisconnected",msg:"websocket disconnect"};wellClient.ui.main({eventName:"wsDisconnected"}),wellClient.triggerInnerOn(n)}})},reconnectWs:function(){setTimeout(function(){g.log(">>> try to reconnect"),g.initWebSocket()},1e3*o.timeout)},closeWebSocket:function(){e.isFunction(u.disconnect)&&u.disconnect(function(e){g.log(e)})},clickCallListening:function(n){e(document).on("click","."+n,function(n){n.stopPropagation();var t=e(n.currentTarget).text().replace(/\D/g,"");l.pt.makeCall(t)})},initSoftPhone:function(){g.clickCallListening(o.clickCallClass),window.onunload=function(){g.closeWebSocket();var e={func:"Logout",device:d.deviceId,namespace:d.user.domain};g.setAgentStateSync(e)}}},v={deliverEvent:function(n){var t=p[n.eventName];e.isFunction(t)&&t(n),e.isFunction(wellClient.exports)&&wellClient.exports(n);var l=v[n.eventName];e.isFunction(l)&&l(n),"ChannelStateChangedEvent"!==n.eventName&&g.logCallMemory()}},f={deliverEvent:function(n){var t=f[n.eventName];e.isFunction(t)&&t(n)}},p={agentLoggedOn:function(e){o.isLogined=!0,a={length:0};var n={eventName:"agentLoggedOn",deviceId:e.deviceId};wellClient.ui.main(n),l.pt.heartbeat(),o.heartbeatId=setInterval(function(){l.pt.heartbeat()},o.heartbeatLength)},agentWorkingAfterCall:function(e){wellClient.ui.main({eventName:"agentWorkingAfterCall"})},agentLoggedOff:function(e){o.isLogined&&(g.clearCache(),g.debugout.clear(),wellClient.ui.main({eventName:"agentLoggedOff"}))},agentReady:function(e){wellClient.ui.main({eventName:"agentReady",reason:e.reason||""})},agentNotReady:function(e){wellClient.ui.main({eventName:"agentNotReady",reason:e.reason||""})},serviceInitiated:function(e){a[e.callId]={deviceCount:0},a.length++,a[e.callId][d.deviceId]={device:d.deviceId,connectionState:"initiated",callId:e.callId,isCalling:!0,callingDevice:e.callingDevice,calledDevice:e.calledDevice},a[e.callId].deviceCount++,a[e.callId].createTimeId=(new Date).valueOf()},originated:function(e){if(!a[e.callId])return void console.error(i.withoutCallId);if(!a[e.callId][e.calledDevice]){var n=a[e.callId][e.callingDevice];n.connectionState="originated",n.callingDevice=e.callingDevice,n.calledDevice=e.calledDevice,a[e.callId][e.calledDevice]={device:e.calledDevice,connectionState:"unknown",callId:e.callId,isCalling:!1,callingDevice:e.callingDevice,calledDevice:e.calledDevice},a[e.callId].deviceCount++,wellClient.ui.main({eventName:"originated",deviceId:e.calledDevice,device:e.calledDevice.split("@")[0],callId:e.callId})}},delivered:function(e){a[e.callId]?a[e.callId][e.calledDevice]?(a[e.callId][e.calledDevice].connectionState="alerting",wellClient.ui.main({eventName:"delivered",deviceId:e.calledDevice,device:e.calledDevice.split("@")[0],callId:e.callId,isCalling:!0,autoAnswer:o.autoAnswer})):(a[e.callId][e.calledDevice]={device:e.calledDevice,connectionState:"delivered",callId:e.callId,isCalling:!0,callingDevice:e.callingDevice,calledDevice:e.calledDevice},a[e.callId].deviceCount++,wellClient.ui.main({eventName:"delivered",deviceId:e.calledDevice,device:e.calledDevice.split("@")[0],callId:e.callId,isCalling:!0,autoAnswer:o.autoAnswer})):(a[e.callId]={deviceCount:0,createTimeId:(new Date).valueOf()},a.length++,a[e.callId][d.deviceId]={device:d.deviceId,connectionState:"alerting",callId:e.callId,isCalling:!1,callingDevice:e.callingDevice,calledDevice:e.calledDevice},a[e.callId].deviceCount++,a[e.callId][e.callingDevice]={device:e.callingDevice,connectionState:"originated",callId:e.callId,isCalling:!0,callingDevice:e.callingDevice,calledDevice:e.calledDevice},a[e.callId].deviceCount++,wellClient.ui.main({eventName:"delivered",deviceId:e.callingDevice,device:e.callingDevice.split("@")[0],callId:e.callId,isCalling:!1,autoAnswer:o.autoAnswer}))},ChannelStateChangedEvent:function(e){},established:function(e){if(!a[e.callId])return void console.error(i.withoutCallId);a[e.callId][e.callingDevice].connectionState=a[e.callId][e.calledDevice].connectionState="connected";var n=e.callingDevice===d.deviceId?e.calledDevice:e.callingDevice;wellClient.ui.main({eventName:"established",deviceId:n,device:n.split("@")[0],callId:e.callId})},connectionCleared:function(e){if(!a[e.callId])return void console.error(i.withoutCallId);var n="connected"===a[e.callId][e.releasingDevice].connectionState,t=a[e.callId].createTimeId,l="",o="",c=!1;if(2===a[e.callId].deviceCount){var r=a[e.callId][d.deviceId];l=r.isCalling?r.calledDevice:r.callingDevice,o=r.isCalling;var s=a[e.callId][d.deviceId].addDevice;c=!(!s||!a[e.callId][s])||g.isOutCall(r.calledDevice||"",r.callingDevice||"")}else 3===a[e.callId].deviceCount&&(c=e.releasingDevice===d.deviceId||!!g.isOutDeviceId(e.releasingDevice));var u={isEstatblished:n,createTimeId:t,data:e,eventName:"connectionCleared",partyDevice:l,isCaller:o,isOutCall:c};if(e.releasingDevice===d.deviceId){var v=a[e.callId][d.deviceId],p=v.isCalling?v.calledDevice:v.callingDevice,I=!1;!a[e.callId][p]&&v.addDevice&&(p=v.addDevice),delete a[e.callId],a.length--,0===a.length&&(I=!0),wellClient.ui.main({eventName:"connectionCleared",deviceId:p,isClearAll:I})}else a[e.callId][e.releasingDevice]&&(delete a[e.callId][e.releasingDevice],a[e.callId].deviceCount--,wellClient.ui.main({eventName:"connectionCleared",deviceId:e.releasingDevice}));f.deliverEvent(u)},held:function(e){if(!a[e.callId])return void console.error(i.withoutCallId);var n=a[e.callId][d.deviceId],t=n.isCalling?n.calledDevice:n.callingDevice;n.connectionState="held",wellClient.ui.main({eventName:"held",device:t.split("@")[0],deviceId:t})},retrieved:function(e){if(!a[e.callId])return void console.error(i.withoutCallId);var n=a[e.callId][d.deviceId],t=n.isCalling?n.calledDevice:n.callingDevice;n.connectionState="connected",wellClient.ui.main({eventName:"retrieved",device:t.split("@")[0],deviceId:t})},conferenced:function(e){if(!a[e.callId]&&a[e.primaryOldCall]){var n=a[e.primaryOldCall],t=n[d.deviceId].callingDevice,l=n[d.deviceId].calledDevice;a[e.callId]={deviceCount:2};var o=a[e.callId];o.isConferenced=!0,o[t]={callId:e.callId,calledDevice:l,callingDevice:t,connectionState:"connected",device:t,isCalling:!0},o[l]={callId:e.callId,calledDevice:l,callingDevice:t,connectionState:"connected",device:l,isCalling:!1},delete a[e.primaryOldCall]}if(a[e.callId]&&a[e.primaryOldCall]){var i=a[e.primaryOldCall],o=a[e.callId],c=i[d.deviceId].isCalling?i[d.deviceId].calledDevice:i[d.deviceId].callingDevice;o[c]={callId:e.callId,calledDevice:i[c].calledDevice,callingDevice:i[c].callingDevice,connectionState:"connected",device:c,isCalling:i.isCalling},g.isOutDeviceId(c)&&(a[e.callId][d.deviceId].addDevice=c),delete a[e.primaryOldCall],a.length--,o.deviceCount++}a[e.callId].isConferenced=!0,a.length,wellClient.ui.main({eventName:"conferenced",callId:e.callId})},agentAllocated:function(e){wellClient.ui.main({eventName:"agentAllocated"})}};l.pt.on=function(e,n){v[e]=n},l.pt.triggerInnerOn=function(e){f.deliverEvent(e)},l.pt.innerOn=function(e,n){f[e]=n},l.pt.getCallMemory=function(){return a},l.pt.trigger=function(e,n){g[e](n)},l.pt.log=function(e){g.log(e)},l.pt.error=function(e){g.error(e)},l.pt.setDebug=function(e){o.debug=e||!0},l.pt.setConfig=function(n){if(o.debug=!1!==n.debug&&o.debug,o.SDK=n.SDK||o.SDK,o.cstaPort=n.cstaPort||o.cstaPort,o.eventPort=n.eventPort||o.eventPort,o.eventBasePath=n.eventBasePath||o.eventBasePath,o.TPI=n.TPI||o.TPI,o.cstaBasePath=n.cstaBasePath||o.cstaBasePath,o.useWsLog=!1!==n.useWsLog&&o.useWsLog,o.clickCallClass=n.clickCallClass||o.clickCallClass,o.autoAnswer=!1!==n.autoAnswer&&o.autoAnswer,o.hideButton=n.hideButton||[],o.hideButton.length>0){var t=o.hideButton.map(function(e){return"#"+e});t=t.join(),e(t).addClass("well-dn")}},l.pt.login=function(n,t,l,o,i){var a=e.Deferred();return g.logCallMemory(),d.user.number=n||r.number,d.user.password=t||r.password,d.user.domain=l||r.domain,d.user.ext=o||r.ext,d.user.agentMode=r.agentMode,loingMode=i||r.loginMode,d.loginId=d.user.number+"@"+d.user.domain,d.deviceId=d.user.ext+"@"+d.user.domain,g.TPILogin(d.user.number,d.user.password,d.user.domain).done(function(e){d.sessionId=e.sessionId,g.initWebSocket(),g.login(i).done(function(e){a.resolve(e)}).fail(function(e){a.reject(e)})}).fail(function(e){g.error("登录失败，请检查用户名、密码、域名是否正确"),a.reject(e)}),a.promise()},l.pt.agentLogin=function(n){var t=e.Deferred();return g.logCallMemory(),d.user.number=n.jobNumber||r.number,d.user.password=n.password||r.password,d.user.domain=n.domain||r.domain,d.user.ext=n.ext||r.ext,d.user.loginMode=n.loginMode||r.loginMode,d.user.agentMode=n.agentMode||r.agentMode,d.loginId=d.user.number+"@"+d.user.domain,d.deviceId=d.user.ext+"@"+d.user.domain,g.TPILogin(d.user.number,d.user.password,d.user.domain).done(function(e){d.sessionId=e.sessionId,g.initWebSocket(),l.pt.heartbeat().always(function(){g.login(d.user.loginMode).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)})})}).fail(function(e){g.error("登录失败，请检查用户名、密码、域名是否正确"),t.reject(e)}),t.promise()},l.pt.logout=function(){var n=e.Deferred();g.logCallMemory();var t={func:"Logout",device:d.deviceId,namespace:d.user.domain,agentId:d.user.number+"@"+d.user.domain};return g.setAgentState(t).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},l.pt.setAgentMode=function(n,t){var o=e.Deferred();if(g.logCallMemory(),"Ready"===n||"NotReady"===n){var i={func:"SetState",device:d.deviceId,agentMode:n,namespace:d.user.domain,reason:t||"",agentId:d.user.number+"@"+d.user.domain};g.setAgentState(i).done(function(e){l.pt.sendPendingMode(e),o.resolve(e)}).fail(function(e){o.reject(e)})}else g.error("参数必须是Ready或者NotReady");return o.promise()},l.pt.sendPendingMode=function(e){"object"==typeof e&&e.pendingMode&&(console.log("come in pending mode"),wellClient.ui.main({eventName:"setPendingMode"}))},l.pt.outputLog=function(n){e.isFunction(wellClient.onLog)&&wellClient.onLog(n)},l.pt.forceDrop=function(e,n){if("string"==typeof e&&"string"==typeof n){var t={callId:n,connectionId:e+"|"+n};return c.dropConnection.fire(t)}},l.pt.forceJoin=function(e,n,t){if("string"==typeof e&&"string"==typeof n&&"string"==typeof t){var l={callId:n,connectionId:e+"|"+n},o={conferenceParticipant:t,participationType:"Active"};return c.singleStepConference.fire(l,o)}},l.pt.forceTake=function(e,n,t){if("string"==typeof e&&"string"==typeof n&&"string"==typeof t){var l={callId:n,connectionId:e+"|"+n},o={transferTo:t};return c.singleStepTransfer.fire(l,o)}},l.pt.forceListen=function(e,n){if("string"==typeof n&&"string"==typeof e){var t={callId:e,deviceId:n};return c.spy.fire(t)}},l.pt.forceReady=function(e,n){if("string"==typeof n&&"string"==typeof e){var t={},l={func:"SetState",agentMode:"Ready",loginId:e,agentId:e,device:n};return c.setAgentState.fire(t,l)}},l.pt.forceNotReady=function(e,n){if("string"==typeof n&&"string"==typeof e){var t={},l={func:"SetState",agentMode:"NotReady",loginId:e,agentId:e,device:n};return c.setAgentState.fire(t,l)}},l.pt.forceLogout=function(e,n){if("string"==typeof n&&"string"==typeof e){var t={},l={namespace:e.split("@")[1],func:"Logout",device:n,agentId:e,loginId:e};return c.setAgentState.fire(t,l)}},l.pt.releaseAllocatedAgent=function(e){return c.releaseAllocatedAgent.fire({agentId:e})},l.pt.getCallData=function(e){e=e||"";var n={callId:e,key:""};return c.getCallData.fire(n)},l.pt.setCallData=function(e,n){e=e||"",n=n||{};var t={callId:e},l={entries:n};return c.setCallData.fire(t,l)},l.pt.heartbeat=function(){var e={agentId:d.loginId};return c.heartbeat.fire(e)},l.pt.transferCall=function(e,n){g.logCallMemory(),e=e||"",n=n||"";var t={callId:e,connectionId:d.deviceId+"|"+e},l={consultCallId:n};return c.transferCall.fire(t,l)},l.pt.cancelConsult=function(e,n){g.logCallMemory(),e=e||"",n=n||"";var t={callId:e,connectionId:d.deviceId+"|"+e},l={consultCallId:n};return c.cancelConsult.fire(t,l)},l.pt.conference=function(e,n){g.logCallMemory(),e=e||"",n=n||"";var t={callId:e,connectionId:d.deviceId+"|"+e},l={consultCallId:n};return c.conference.fire(t,l)},l.pt.consult=function(e,n){g.logCallMemory(),e=e||"",n=n||"";var t={callId:e,connectionId:d.deviceId+"|"+e},l={consultationParticipant:n};return c.consult.fire(t,l)},l.pt.singleStepConference=function(e,n,t){g.logCallMemory(),e=e||"",n=n||"",t=t||"";var l={callId:e,connectionId:d.deviceId+"|"+e},o={conferenceParticipant:n,participationType:t||"Active"};return c.singleStepConference.fire(l,o)},l.pt.singleStepTransfer=function(e,n){g.logCallMemory(),e=e||"",n=n||"";var t={callId:e,connectionId:d.deviceId+"|"+e},l={transferTo:n};return c.singleStepTransfer.fire(t,l)},l.pt.retrieveCall=function(e){g.logCallMemory(),e=e;var n={callId:e,connectionId:d.deviceId+"|"+e};return c.retrieveCall.fire(n)},l.pt.holdCall=function(e){g.logCallMemory(),e=e||"";var n={callId:e,connectionId:d.deviceId+"|"+e};return c.holdCall.fire(n)},l.pt.dropConnection=function(n){g.logCallMemory(),n=n||g.getCallId();var t=(e.Deferred(),{callId:n,connectionId:d.deviceId+"|"+n});return c.dropConnection.fire(t)},l.pt.answerCall=function(e){g.logCallMemory(),e=e||"";var n={callId:e,connectionId:d.deviceId+"|"+e};return c.answerCall.fire(n)},l.pt.makeCall=function(e,n){g.logCallMemory(),n=n||{};var t=l.pt.getCallMemory().length;if(g.isPhoneNumber(e))if(e===d.user.ext)g.error("请勿输入自己的号码");else{if(!(t>0)){var o={from:d.deviceId,to:(n.prefix||"")+e};return c.makeCall.fire({},o)}alert("当前已有一通通话，请挂断当前通话后再拨打"),g.error("already had a line, please drop current line then make another call")}else g.error("输入号码不合法")},l.pt.get=function(n){return e(n)},l.pt.getCache=function(){return s},l.pt.render=function(e,n){for(var t=/{{([^}]+)?}}/g,l="";l=t.exec(e);)e=e.replace(l[0],n[l[1]]);return e},l.pt.isPhoneNumber=function(e){return g.isPhoneNumber(e)},l.pt.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},l.pt.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},l.pt.findItem=function(e,n,t){if(!l.pt.isArray(e))return!1;if("string"!=typeof n)return!1;if(void 0===t)return!1;for(var o=0;o<e.length;o++)if(e[o][n]===t)return o;return-1},l.pt.deliverEvent=function(e){v.deliverEvent(e)},l.pt.isLogined=function(){return o.isLogined},g.debugout=new t,l.pt.downloadLog=g.debugout.downloadLog,l.pt.getLog=g.debugout.getLog,l.pt.clearLog=g.debugout.clear,l.pt.seacchLog=g.debugout.search,l.pt.enableLog=function(){o.useEventLog=!0},l.pt.disableLog=function(){o.useEventLog=!1},window.addEventListener("message",function(e){var n=e.data;try{n=JSON.parse(n),I.deliverMessage(n)}catch(e){g.error(e),g.error("message must be a stringify object!!")}});var I={deliverMessage:function(n){var t=n.method;e.isFunction(this[t])&&"deliverMessage"!==t&&this[t](n)},getCallMemory:function(e){g.logCallMemory()},makeCall:function(e){var n=e.phoneNumber;wellClient.makeCall(n)},logEnv:function(){console.log(d)},getLog:function(){console.log(wellClient.getLog())},downloadLog:function(){wellClient.downloadLog()}};return new l}(jQuery);