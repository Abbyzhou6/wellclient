<!DOCTYPE html>
<html lang="zh-cn">

<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="public/css/well-client.css">
	<script src="public/js/jquery-1.11.3.min.js"></script>
	<script src="public/js/stomp.min.js"></script>
	<script src="public/js/well-client.js"></script>
	<script src="public/js/well-client-ui.js"></script>
</head>

<body>

<div id="well-client" class="well-client">
	<button class="well-btn well-show-state">
		<span id="well-device" title="当前分机号">分机号</span>
	</button>
	<button id="well-answer" class="well-btn well-answer well-answer-on well-disabled">应答</button>
	<button id="well-drop" class="well-btn well-drop well-drop-on well-disabled">挂断</button>
	<button id="well-hold" class="well-btn well-hold well-hold-on well-disabled">保持</button>

	<input id="well-input" class="well-dn" type="" name="" placeholder="输入号码" maxlength="15">
	<select id="well-phone-number">
		<option value="">--未选择--</option>
		<option value="8003">8003</option>
		<option value="918061929558">918061929558</option>
		<option value="8004">8004</option>
		<option value="8014">8014</option>
		<option value="8015">8015</option>
		<option value="918221365463">918221365463</option>
	</select>

	<button id="well-make" class="well-btn well-make well-make-on well-disabled well-dn">拨打</button>

	<button id="well-consult" class="well-btn well-consult well-consult-on well-disabled">咨询</button>
	<button id="well-conference" class="well-btn well-conference well-conference-on well-disabled">会议</button>
	<button id="well-transfer" class="well-btn well-transfer well-transfer-on well-disabled">转接</button>
	<button id="well-cancel" class="well-btn well-cancel well-cancel-on well-disabled">接回</button>
	<button id="well-single" title="直接转需要先输入对方的号码" class="well-btn well-single well-single-on well-disabled">直接转</button>

	<select id="well-dest" class="well-disabled">
		<option value="">转接到</option>
		<option value="8004">转8004</option>
		<option value="8013">转客户金卡维护</option>
		<option value="8014">转客户普卡维护</option>
		<option value="918221365463">918221365463</option>
	</select>


	<button class="well-btn well-show-state">
		<span id="well-now-state" title="当前坐席状态">未登录</span>
	</button>

	<select id="well-changestate" class="well-disabled" onchange="console.log('change')">
		<option value="Ready:">就绪</option>
		<option value="NotReady:1">示忙</option>
		<option value="NotReady:2">手工外呼</option>
	</select>

	<span id="well-login-info">
		工号：<input type="text" id="well-code" value="" class="well-login-info" maxlength="10">
		密码：<input type="text" id="well-password" value="" class="well-login-info" maxlength="20">
		域名：<input type="text" id="well-namespace" value="" class="well-login-info" maxlength="20">
		分机号：<input type="text" id="well-deviceId" value="" class="well-login-info" maxlength="10">
		<button id="well-loading" class="well-btn well-loading well-dn" title="正在登录..."></button>
	</span>

	<button id="well-logout" class="well-btn well-logout well-dn" title="签出"></button>
	<button id="well-login" class="well-btn well-login" title="签入"></button>

	<span id="well-login-error-msg">

	</span>
</div>


<div class="well-dn">
	<p>工号：<input type="text" id="code" value=""></p>
	<p>密码：<input type="text" id="password" value=""></p>
	<p>域名：<input type="text" id="namespace" value=""></p>
	<p>分机号：<input type="text" id="deviceId" value=""></p>

	<button id="login">登录</button>
</div>

<script type="text/javascript">
	(function(){
		// this part is use to config the user info and other config
		// for the test and dev environment
		// you can just remove it, or just ignore it
		var href = location.href;
		var needUseLocalStorage = /file:|coding/.test(href);
		if(!window.localStorage){return;}
		if(!needUseLocalStorage){return;}

		var code = localStorage.getItem('code');
		if(code){
			$('#well-code').val(code);
		}

		var password = localStorage.getItem('password');
		if(password){
			$('#well-password').val(password);
		}

		var namespace = localStorage.getItem('namespace');
		if(namespace){
			$('#well-namespace').val(namespace);
		}

		var deviceId = localStorage.getItem('deviceId');
		if(deviceId){
			$('#well-deviceId').val(deviceId);
		}

		var sdk = localStorage.getItem('sdk');
		if(sdk){
			$('#sdk').val(sdk);
		}

		var port = localStorage.getItem('port');
		if(port){
			$('#port').val(port);
		}

		var tpi = localStorage.getItem('tpi');
		if(tpi){
			$('#tpi').val(tpi);
		}
	})();




	$('#login').click(function(){
		var $login = $('#login');

		var code = $('#code').val();
		var password = $('#password').val();
		var namespace = $('#namespace').val();
		var deviceId = $('#deviceId').val();

		if(!code || !password || !namespace || !deviceId){
			alert('工号，密码，域名，分机号都是必填项');
			return;
		}

		$login.attr('disabled', 'disabled');

		wellClient.login(code, password, namespace, deviceId)
		.done(function(res){
			if(!window.localStorage){return;}
			localStorage.setItem('code', code);
			localStorage.setItem('password', password);
			localStorage.setItem('password', password);
			localStorage.setItem('namespace', namespace);
			localStorage.setItem('namespace', namespace);
			localStorage.setItem('deviceId', deviceId);
		})
		.always(function(){
			$login.removeAttr('disabled');
		});

		$('#tip').text('');
	});
</script>

<div>
	<h2>如果需要配置，首先请配置一下（默认是指向招银云环境的）</h2>
	<p>SDK地址：<input type="text" id="sdk" value="cmbyc.wellcloud.cc"></p>
	<p>SDK端口：<input type="text" id="port" value="8088"></p>
	<p>TPI地址及端口：<input type="text" id="tpi" value="cmbyc.wellcloud.cc:5003/login"></p>

	<button id="config">配置</button> <span id="tip"></span>

	<br>
	<br>
	<button onclick="wellClient.downloadLog()">下载所有事件日志</button>
	<button onclick="wellClient.clearLog()">清空所有事件日志</button>
</div>


<a href="./index-iframe.html">iframe方式引入</a>

<script type="text/javascript">
(function(){
	if(!window.localStorage){return;}

	var code = localStorage.getItem('code');
	if(code){
		$('#code').val(code);
	}

	var password = localStorage.getItem('password');
	if(password){
		$('#password').val(password);
	}

	var namespace = localStorage.getItem('namespace');
	if(namespace){
		$('#namespace').val(namespace);
	}

	var deviceId = localStorage.getItem('deviceId');
	if(deviceId){
		$('#deviceId').val(deviceId);
	}
})();


	$('#config').click(function(){
		var $login = $('#config');

		var sdk = $('#sdk').val();
		var port = $('#port').val();
		var tpi = $('#tpi').val();

		var config = {
			SDK: sdk,
			cstaPort: port,
			eventPort: port,
			TPI: tpi
		};

		wellClient.setConfig(config);
		$('#tip').text('配置成功');

		// localStorage.setItem('sdk', sdk);
		// localStorage.setItem('port', port);
		// localStorage.setItem('tpi', tpi);

		setTimeout(function(){
			$('#tip').text('');
		},2000);
	});

	wellClient.innerOn('connectionCleared', function(res){
		console.log(res);
	});

	wellClient.innerOn('loginFailed', function(res){
		console.log(res);
	});

	wellClient.innerOn('wsDisconnected', function(res){
		console.log(res);
	});
</script>



</body>
</html>